<!DOCTYPE html>
<html>
<head>
  <title>All Categories</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    .category-card {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
    }
    .category-card h3 {
      margin: 0;
    }
    .buttons {
      margin-top: 10px;
    }
    .buttons a {
      margin-right: 10px;
      text-decoration: none;
      color: white;
      background: #007bff;
      padding: 6px 12px;
      border-radius: 4px;
    }
    .buttons a:hover {
      background-color: #0056b3;
    }
    .buttons button {
      background-color: crimson;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .pagination a {
      margin-right: 8px;
      text-decoration: none;
    }
  </style>
</head>
<body>

  <h1>üìÅ Categories</h1>

  <a href="/categories/new">‚ûï Add New Category</a>

  <% if (data.length === 0) { %>
    <p>No categories available.</p>
  <% } else { %>
    <% data.forEach(category => { %>
      <div class="category-card" id="cat-<%= category.category_id %>">
        <h3><%= category.category_name %></h3>
        <div class="buttons">
          <a href="/category/<%= category.category_id %>/items">üì¶ View Items</a>
          <a href="/category/<%= category.category_id %>/edit">‚úèÔ∏è Edit</a>
          <button onclick="deleteCategory('<%= category.category_id %>')">üóëÔ∏è Delete</button>
        </div>
      </div>
    <% }) %>
  <% } %>

  <!-- Pagination -->
  <div class="pagination">
    <% for (let i = 1; i <= totalPages; i++) { %>
      <% if (i === page) { %>
        <strong><%= i %></strong>
      <% } else { %>
        <a href="/categories?page=<%= i %>"><%= i %></a>
      <% } %>
    <% } %>
  </div>

  <!-- JavaScript for DELETE -->
  <script>
    async function deleteCategory(catId) {
      if (!confirm("Are you sure you want to delete this category?")) return;

      try {
        const res = await fetch(`/category/${catId}`, {
          method: 'DELETE'
        });

        if (res.status === 204) {
          // Remove the category card from the DOM
          const card = document.getElementById(`cat-${catId}`);
          if (card) card.remove();
        } else {
          alert("Failed to delete category.");
        }
      } catch (err) {
        console.error(err);
        alert("An error occurred while deleting.");
      }
    }
  </script>

</body>
</html>
